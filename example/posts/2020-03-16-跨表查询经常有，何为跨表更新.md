---
title: è·¨è¡¨æŸ¥è¯¢ç»å¸¸æœ‰ï¼Œä½•ä¸ºè·¨è¡¨æ›´æ–°
subtitle: æ–‡ç« æš‚å­˜
author: systemime
date: 2020-03-16
header_img: /img/in-post/2020-10-29/header.jpg
catalog: true
tags:
  - python
---

æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸–ç•Œ.

<!-- more -->

æœ‰ç‚¹ SQL åŸºç¡€çš„æœ‹å‹è‚¯å®šå¬è¿‡ ã€Œè·¨è¡¨æŸ¥è¯¢ã€ï¼Œé‚£å•¥æ˜¯è·¨è¡¨æ›´æ–°å•Šï¼Ÿ

## èƒŒæ™¯

é¡¹ç›®æ–°å¯¼å…¥äº†ä¸€æ‰¹äººå‘˜æ•°æ®ï¼Œè¿™äº›äººçš„æœ‰çš„éƒ¨é—¨åç§°å‘ç”Ÿäº†å˜åŒ–ï¼Œæœ‰çš„è”ç³»æ–¹å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œæš‚ä¸”ç§°è¯¥è¡¨ä¸º

`t_dept_members`, ç³»ç»Ÿä¸­æœ‰å¦å¤–ä¸€å¼ è¡¨ `t_user_info` è®°å½•äº†äººå‘˜ä¿¡æ¯ã€‚è¦æ±‚å°† `t_dept_members` ä¸­æœ‰å˜åŒ–çš„ä¿¡æ¯æ›´æ–°åˆ° `t_user` è¡¨ä¸­ï¼Œè¿™ä¸ªéœ€æ±‚å°±æ˜¯ã€Œè·¨è¡¨æ›´æ–°ã€å•¦

## æ†¨ B SQL ç›´æ¥è¢«ç§’æ€

ä¸å¸¦è„‘å­å‡ºé—¨çš„å°±å†™å‡ºäº†ä¸‹é¢çš„ SQL

![](https://image-static.segmentfault.com/215/783/2157832158-5e376df158c3c_articlex)

çœ‹åˆ°èº«å DBA å°æ®µæ€»åœ¨ä¿®ä»™ï¼Œæƒ³ç€è®©ä»–å¸®æ¶¦è‰²ä¸€ä¸‹ğŸ˜œï¼Œäºæ˜¯å‘ç»™äº†ä»–ï¼Œç„¶åç”©æ‰‹å›æ¥å°±æ˜¯è¿™ä¸ªæ ·å­ï¼š

![](https://image-static.segmentfault.com/353/299/3532997857-5e376df214033_articlex)

â€‹

çœ‹åˆ°è¿™ä¸ª SQL è¯­å¥æˆ‘éƒ½æƒŠå‘†äº†ï¼Œè¿˜èƒ½è¿™æ ·å†™ï¼Œåœ¨æ— æƒ…çš„å˜²ç¬‘ä¸‹ï¼Œä¸€å£° KO æˆ‘ç›´æ¥å€’ä¸‹ã€‚æ­»ä¹Ÿå¾—æ­»çš„æ˜ç™½ï¼Œå’±å¾—æŸ¥æŸ¥è¿™æ˜¯å’‹å›äº‹å•Š

## Mysql Update Join

æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ `join` æŸ¥è¯¢è¡¨ä¸­å…·æœ‰ï¼ˆåœ¨ `INNER JOIN` æƒ…å†µä¸‹ï¼‰æˆ–å¯èƒ½æ²¡æœ‰ï¼ˆåœ¨ `LEFT JOIN` æƒ…å†µä¸‹ï¼‰å¦ä¸€ä¸ªè¡¨ä¸­åŒ¹é…è¡Œçš„è¡¨ä¸­çš„è¡Œã€‚

åŒæ ·ï¼Œåœ¨ MySQL ä¸­, æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ UPDATE è¯­å¥ä¸­ä½¿ç”¨ JOIN å­å¥æ‰§è¡Œè·¨è¡¨æ›´æ–°ï¼Œè¯­æ³•å°±æ˜¯è¿™æ ·ï¼š

    UPDATE T1, T2,
    [INNER JOIN | LEFT JOIN] T1 ON T1.C1 = T2. C1
    SET T1.C2 = T2.C2,
        T2.C3 = expr
    WHERE condition

æˆ‘ä»¬è¿˜æ˜¯è¯¦ç»†çš„è¯´æ˜ä¸€ä¸‹ä¸Šé¢çš„è¯­æ³•ï¼š

-   é¦–å…ˆï¼Œåœ¨ UPDATE å­å¥ä¹‹åï¼ŒæŒ‡å®šä¸»è¡¨ï¼ˆT1ï¼‰å’Œå¸Œæœ›ä¸»è¡¨è”æ¥åˆ°çš„è¡¨ï¼ˆT2ï¼‰ã€‚è¯·æ³¨æ„ï¼Œå¿…é¡»åœ¨ UPDATE å­å¥ä¹‹åè‡³å°‘æŒ‡å®šä¸€ä¸ªè¡¨
-   æ¥ä¸‹æ¥ï¼ŒæŒ‡å®šä½ è¦ä½¿ç”¨çš„è”æ¥ç±»å‹ï¼Œå³ INNER JOIN æˆ– LEFT JOIN ä»¥åŠè”æ¥è°“è¯ã€‚ JOIN å­å¥å¿…é¡»å‡ºç°åœ¨ UPDATE å­å¥ä¹‹åï¼ˆè¿™ä¸ªå¤§å®¶éƒ½æ˜¯çŸ¥é“çš„å“ˆï¼‰
-   ç„¶åï¼Œå°†æ–°å€¼åˆ†é…ç»™è¦æ›´æ–°çš„ T1 æˆ– T2 è¡¨ä¸­çš„åˆ—
-   æœ€åï¼Œåœ¨ WHERE å­å¥ä¸­æŒ‡å®šä¸€ä¸ªæ¡ä»¶ä»¥å°†è¡Œé™åˆ¶ä¸ºè¦æ›´æ–°çš„è¡Œ

å¦‚æœä½ éµå¾ª update è¯­æ³•ï¼Œä½ ä¼šå‘ç°æœ‰å¦å¤–ä¸€ç§è¯­æ³•ä¹Ÿå¯ä»¥å®Œæˆè·¨è¡¨æ›´æ–°

    UPDATE T1, T2
    SET T1.c2 = T2.c2,
          T2.c3 = expr
    WHERE T1.c1 = T2.c1 AND condition

ä¸Šé¢çš„è¯­æ³•å…¶å®éšå¼ä½¿ç”¨äº† inner join å…³é”®å­—ï¼Œå®Œå…¨ç­‰åŒäºä¸‹é¢çš„æ ·å­ï¼š

    UPDATE T1,T2
    INNER JOIN T2 ON T1.C1 = T2.C1
    SET T1.C2 = T2.C2,
          T2.C3 = expr
    WHERE condition

_ä¸ªäººå»ºè®®è¿˜æ˜¯åŠ ä¸Š `inner join` å…³é”®å­—å§ï¼Œè¿™æ ·å¯è¯»æ€§æ›´å¥½ï¼Œå°½äº«ä¸æ»‘ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿ_

> æˆ‘æ‘¸é±¼çœ‹åˆ°çš„ï¼Œè§‰å¾—æ˜¯çµé­‚ç¿»è¯‘
>
> è°ˆå¤ªå»‰ï¼Œç§€ä½ ç  ï¼ˆTalk is cheapï¼Œshow me the codeï¼‰

## Update Join ä¾‹å­

å¹´åº•äº†ï¼Œåˆåˆ°äº†è¯„ç»©æ•ˆçš„æ—¶å€™äº†ï¼Œå°±æ˜¯é‚£ä¸ªå« KPI çš„ä¸œä¸œï¼ˆä½ ä»¬æœ‰å—ï¼‰ï¼Œå¬è¯´è¦æ ¹æ® KPI è°ƒå·¥èµ„äº†ã€‚æœ‰ä¸¤å¼ è¡¨

ç¬¬ä¸€å¼ è¡¨ã€Œemployees - å‘˜å·¥è¡¨ã€

![](https://image-static.segmentfault.com/222/180/2221800456-5e376df2c755d_articlex)

å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š

    create table employees
    (
        employee_id bigint auto_increment comment 'å‘˜å·¥IDï¼Œä¸»é”®',
        employee_name varchar(50) null comment 'å‘˜å·¥åç§°',
        performance int(4) null comment 'ç»©æ•ˆåˆ†æ•° 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5',
        salary float null comment 'å‘˜å·¥è–ªæ°´',
        constraint employees_pk
            primary key (employee_id)
    )
    comment 'å‘˜å·¥è¡¨';

ç¬¬äºŒå¼ è¡¨ã€Œmerits - ç»©æ•ˆå­—å…¸è¡¨ã€

![](https://image-static.segmentfault.com/310/049/310049140-5e376df3701f7_articlex)

å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š

    create table merits
    (
        performance int(4) null,
        percentage float null
    )
    comment 'ç»©æ•ˆå­—å…¸è¡¨';

å…ˆç”Ÿæˆä¸€äº›æ¨¡æ‹Ÿæ•°æ®

     INSERT INTO merits(performance, percentage)
    VALUES (1, 0),
           (2, 0.01),
           (3, 0.03),
           (4, 0.05),
           (5, 0.08);

    INSERT INTO employees(employee_name, performance, salary)
    VALUES ('æ‹±å“¥', 1, 1000),
           ('å°æ®µæ€»', 3, 20000),
           ('å¤§äºº', 4, 18000),
           ('å¸ä»¤', 5, 28000),
           ('è€å…­', 2, 10000),
           ('ç½—è’™', 3, 20000);

![](https://image-static.segmentfault.com/808/226/808226297-5e376df4424d6_articlex)

> è°ƒè–ªè§„åˆ™ï¼š
>
> åŸæœ‰è–ªèµ„ + ï¼ˆåŸæœ‰è–ªèµ„ \* å½“å‰ç»©æ•ˆå¯¹åº”çš„è°ƒè–ªç™¾åˆ†æ¯”ï¼‰

æŒ‰ç…§è°ƒè–ªè§„åˆ™å†™ update è¯­å¥ï¼š

    UPDATE employees
        INNER JOIN
        merits ON employees.performance = merits.performance
    SET salary = salary + salary * percentage;

![](https://image-static.segmentfault.com/337/533/3375330888-5e376df4e1bea_articlex)

æ‹±å“¥ç»©æ•ˆä¸å¥½ï¼Œæ²¡ç»™æ¶¨å·¥èµ„......

> ä¸‰æ¨ªä¸€ç«–ä¸€å’•å˜ï¼Œå››ä¸ªå°çŒªğŸ·æ¥åƒ zhaï¼Œå’•å˜å’•å˜åˆæ¥ä¿©

ä¸´è¿‘å¹´åº•ï¼Œå…¬å¸åˆæ¥äº†ä¸¤ä½æ–°åŒäº‹, ä½†æ˜¯å…¬å¸å¹´åº¦ç»©æ•ˆå·²ç»è¯„å®Œï¼Œæ‰€ä»¥æ–°å‘˜å·¥ç»©æ•ˆä¸º NULL

    INSERT INTO employees(employee_name, performance, salary)
    VALUES ('é¦®å¤§', NULL, 8000),
           ('é¦®äºŒ', NULL, 5000);

æ–°å‘˜å·¥å·¥ä½œå¹²çš„ä¸é”™ï¼Œä¹Ÿè¦ `1.5%` æ¶¨ç‚¹å·¥èµ„çš„ã€‚å¦‚æœæˆ‘ä»¬è¿˜æ˜¯ç”¨ `UPDATE INNER JOIN`ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ›´æ–°è¯­å¥æ˜¯ä¸å¯èƒ½å®Œæˆçš„ï¼Œå› ä¸ºæ¡ä»¶ç­‰å¼ä¸æˆç«‹ï¼Œè¿™æ˜¯æˆ‘ä»¬å°±è¦ç”¨åˆ° `UPDATE LEFT JOIN` äº†

    UPDATE employees
        LEFT JOIN
        merits ON employees.performance = merits.performance
    SET salary = salary + salary * 0.015
    WHERE merits.percentage IS NULL;

![](https://image-static.segmentfault.com/654/014/65401401-5e376df59e1ee_articlex)

åˆ°è¿™é‡Œï¼Œæ–°å‘˜å·¥çš„æ¶¨è–ªå·¥ä½œä¹Ÿåšå®Œï¼Œæ‹±å“¥ç”±äºçŸ¥è¯†ç‚¹äº†è§£ä¸é€å½»ï¼Œç°æºœæºœçš„å›å®¶è¿‡å¹´

* * *

-   å¦‚æœä½ ä¹Ÿæ°å·§åˆšçŸ¥é“è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¯·ç‚¹ä¸ªã€Œèµã€
-   å¦‚æœä½ æ—©éƒ½çŸ¥é“äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œè¿˜è¯·ç•™è¨€é€ä¸Šã€Œå˜˜å£°ã€
-   å¦‚æœä½ å¹´ç»ˆå¥–ä¸°åšï¼Œå¸Œæœ›ä½  2020 å¹´æ›´è¿›ä¸€æ­¥
-   å¦‚æœä½ å’Œæˆ‘ä¸€æ ·æ²¡æœ‰å¹´ç»ˆå¥–ï¼Œåˆ«ç°å¿ƒï¼Œæˆ‘ä»¬æºæ‰‹è¿›æ­¥

æµæ„Ÿä¸¥é‡ğŸ˜·ï¼Œæ˜¥è¿æ—…é€”å¤šåŠ å°å¿ƒ

> æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å· ã€Œæ—¥æ‹±ä¸€å…µã€ï¼Œè¶£å‘³åŸåˆ›è§£æ Java æŠ€æœ¯æ ˆé—®é¢˜ï¼Œå°†å¤æ‚é—®é¢˜ç®€å•åŒ–ï¼Œå°†æŠ½è±¡é—®é¢˜å›¾å½¢åŒ–è½åœ°  
> å¦‚æœå¯¹æˆ‘çš„ä¸“é¢˜å†…å®¹æ„Ÿå…´è¶£ï¼Œæˆ–æŠ¢å…ˆçœ‹æ›´å¤šå†…å®¹ï¼Œæ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢ [dayarch.top](https://dayarch.top/) 
>  [https://segmentfault.com/a/1190000021675558#](https://segmentfault.com/a/1190000021675558#) 
>  [https://segmentfault.com/a/1190000021675558#](https://segmentfault.com/a/1190000021675558#)
